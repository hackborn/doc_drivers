package {{.Package}}

// autogenerated with {{.ToxPackage}} on {{.Datestamp}}
// do not modify

import (
	"sync/atomic"
)

type {{.Prefix}}Metadata struct {
	table  string   // table name
	tags   []string // List of all the tags in the table
	fields []string // List of all field names in the source struct, corresponding to tags
	keys   map[string]*{{.Prefix}}KeyMetadata

	ttf atomic.Pointer[map[string]string] // Map of tags to their assocated fields. Generated value, only call TagsToFields().
	ftt atomic.Pointer[map[string]string] // Map of fields to their assocated tags. Generated value, only call FieldsToTags().
}

func (m *{{.Prefix}}Metadata) TagsToFields() map[string]string {
	if p := m.ttf.Load(); p != nil {
		return *p
	}
	p := {{.Prefix}}MakeMetadataMap(m.tags, m.fields)
	m.ttf.Store(&p)
	return p
}

func (m *{{.Prefix}}Metadata) FieldsToTags() map[string]string {
	if p := m.ftt.Load(); p != nil {
		return *p
	}
	p := {{.Prefix}}MakeMetadataMap(m.fields, m.tags)
	m.ftt.Store(&p)
	return p
}

type {{.Prefix}}KeyMetadata struct {
	tags   []string
	fields []string

	ftt atomic.Pointer[map[string]string] // Map of fields to their assocated tags. Generated value, only call FieldsToTags().
}

func (m *{{.Prefix}}KeyMetadata) FieldsToTags() map[string]string {
	if p := m.ftt.Load(); p != nil {
		return *p
	}
	p := {{.Prefix}}MakeMetadataMap(m.fields, m.tags)
	m.ftt.Store(&p)
	return p
}

func {{.Prefix}}MakeMetadataMap(keys, values []string) map[string]string {
	c := make(map[string]string)
	for i, k := range keys {
		c[k] = values[i]
	}
	return c
}

var (
	{{.Prefix}}Metadatas = map[string]*{{.Prefix}}Metadata{
		"Company": &{{.Prefix}}Metadata{
			table:  "Company",
			tags:   []string{"id", "name", "val", "fy"},
			fields: []string{"Id", "Name", "Value", "FoundedYear"},
			keys: map[string]*{{.Prefix}}KeyMetadata{
				"": &{{.Prefix}}KeyMetadata{
					tags:   []string{"id"},
					fields: []string{"Id"},
				},
				"b": &{{.Prefix}}KeyMetadata{
					tags:   []string{"name"},
					fields: []string{"Name"},
				},
			},
		},
		"Filing": &{{.Prefix}}Metadata{
			table:  "Filing",
			tags:   []string{"ticker", "end", "form", "val", "units", "fy"},
			fields: []string{"Ticker", "EndDate", "Form", "Value", "Units", "FiscalYear"},
			keys: map[string]*{{.Prefix}}KeyMetadata{
				"": &{{.Prefix}}KeyMetadata{
					tags:   []string{"ticker", "end", "form"},
					fields: []string{"Ticker", "EndDate", "Form"},
				},
			},
		},
	}
)
